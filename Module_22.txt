Network Traffic:
The amount of data that moves across a network.

Network Data:
The data that's transmitted between devices on a network.

Indicators of Compromise (IOCs):
Observable evidence that suggests signs of a potential security incident.

Data Exfiltration:
Unauthorized transmission of data from a system.

Monitor Your Network:
networks connect devices, and devices then communicate and exchange data using network protocols. Network communications provide 
information about connections such as source and destination IP addresses, amount of data transferred, date and time, and more. 
This information can be valuable for security professionals when developing a baseline of normal or expected behavior. 

 Flow analysis:
 Flow refers to the movement of network communications and includes information related to packets, protocols, and ports. Packets 
 can travel to ports, which receive and transmit communications. Ports are often, but not always, associated with network protocols. 
 For example, port 443 is commonly used by HTTPS which is a protocol that provides website traffic encryption. However, malicious 
 actors can use protocols and ports that are not commonly associated to maintain communications between the compromised system and 
 their own machine. These communications are what’s known as command and control (C2), which are the techniques used by malicious 
 actors to maintain communications with compromised systems. For example, malicious actors can use HTTPS protocol over port 8088 as 
 opposed to its commonly associated port 443 to communicate with compromised systems. Organizations must know which ports should be 
 open and approved for connections, and watch out for any mismatches between ports and their associated protocols.

 Packet payload information:
 Network packets contain components related to the transmission of the packet. This includes details like source and destination IP 
 address, and the packet payload information, which is the actual data that’s transmitted. Often, this data is encrypted and requires 
 decryption for it to be readable. Organizations can monitor the payload information of packets to uncover unusual activity, such 
 as sensitive data transmitting outside of the network, which could indicate a possible data exfiltration attack.

 Temporal patterns:
 Network packets contain information relating to time. This information is useful in understanding time patterns. For example, a 
 company operating in North America experiences bulk traffic flows between 9 a.m. to 5 p.m., which is the baseline of normal network 
 activity. If large volumes of traffic are suddenly outside of the normal hours of network activity, then this is considered off 
 baseline and should be investigated. Through network monitoring, organizations can promptly detect network intrusions and work to 
 prevent them from happening by securing network components.

 Protect your network:
 Organizations may deploy a network operations center (NOC), which is an organizational unit that monitors the performance of a 
 network and responds to any network disruption, such as a network outage. While a SOC is focused on maintaining the security of an 
 organization through detection and response, a NOC is responsible for maintaining network performance, availability, and uptime. 
 Security analysts monitor networks to identify any signs of potential security incidents known as indicators of compromise (IoC) 
 and  protect networks from threats or attacks. To do this, they must understand the environment that network communications travel 
 through so that they can identify deviations in network traffic. 

 Network monitoring tools:
 Network monitoring can be automated or performed manually. Some common network monitoring tools can include: 

 ->Intrusion detection systems (IDS) monitor system activity and alert on possible intrusions. An IDS will detect and alert on the 
   deviations you’ve configured it to detect. Most commonly, IDS tools will monitor the content of packet payload to detect patterns
   associated with threats such as malware or phishing attempts.

 ->Network protocol analyzers, also known as packet sniffers, are tools designed to capture and analyze data traffic within a network. 
   They can be used to analyze network communications manually in detail. Examples include tools such as tcpdump and Wireshark, which 
   can be used by security professionals to record network communications through packet captures. Packet captures can then be 
   investigated to identify potentially malicious activity.

Packets:
A data packet is a basic unit of information that travels from one device to another within a network. Detecting network intrusions 
begins at the packet level. That's because packets form the basis of information exchange over a network. Each time you perform an 
activity on the internet—like visiting a website—packets are sent and received between your computer and the website’s server. 
These packets are what help transmit information through a network. For example, when uploading an image to a website, the data gets 
broken up into multiple packets, which then get routed to the intended destination and reassembled upon delivery. 

 Components of a packet:

 1.Header: Packets begin with the most essential component: the header. Packets can have several headers depending on the protocols 
   used such as an Ethernet header, an IP header, a TCP header, and more. Headers provide information that’s used to route packets 
   to their destination. This includes information about the source and destination IP addresses, packet length, protocol, packet 
   identification numbers, and more. 

 2.Payload: The payload component directly follows the header and contains the actual data being delivered. Think back to the example 
   of uploading an image to a website; the payload of this packet would be the image itself.

 3.Footer: The footer, also known as the trailer, is located at the end of a packet. The Ethernet protocol uses footers to provide 
   error-checking information to determine if data has been corrupted. In addition, Ethernet network packets that are analyzed might 
   not display footer information due to network configurations.

   Note: Most protocols, such as the Internet Protocol (IP), do not use footers. 

Network protocol analyzers:
Network protocol analyzers (packet sniffers) are tools designed to capture and analyze data traffic within a network. Examples of 
network protocol analyzers include tcpdump, Wireshark, and TShark. Beyond their use in security as an investigative tool used to 
monitor networks and identify suspicious activity, network protocol analyzers can be used to collect network statistics, such as 
bandwidth or speed, and troubleshoot network performance issues, like slowdowns. Network protocol analyzers can also be used for 
malicious purposes. For example, malicious actors can use network protocol analyzers to capture packets containing sensitive data, 
such as account login information.

 How network protocol analyzers work:
 Network protocol analyzers use both software and hardware capabilities to capture network traffic and display it for security 
 analysts to examine and analyze. Here’s how:

 1.First, packets must be collected from the network via the Network Interface Card (NIC), which is hardware that connects computers 
 to a network, like a router. NICs receive and transmit network traffic, but by default they only listen to network traffic that’s 
 addressed to them. To capture all network traffic that is sent over the network, a NIC must be switched to a mode that has access 
 to all visible network data packets. In wireless interfaces this is often referred to as monitoring mode, and in other systems it 
 may be called promiscuous mode. This mode enables the NIC to have access to all visible network data packets, but it won’t help 
 analysts access all packets across a network. A network protocol analyzer must be positioned in an appropriate network segment to 
 access all traffic between different hosts. 

 2.The network protocol analyzer collects the network traffic in raw binary format. Binary format consists of 0s and 1s and is not 
 as easy for humans to interpret. The network protocol analyzer takes the binary and converts it so that it’s displayed in a 
 human-readable format, so analysts can easily read and understand the information.  

 Note: Enabling promiscuous can expose your device to potential attacks because it allows sensitive information like passwords and 
 other confidential data to be captured. It's important to use tools that operate in promiscuous mode responsibly and with caution.

 Capturing packets:
 Packet sniffing is the practice of capturing and inspecting data packets across a network. A packet capture (p-cap) is a file 
 containing data packets intercepted from an interface or network. Packet captures can be viewed and further analyzed using network 
 protocol analyzers. For example, you can filter packet captures to only display information that's most relevant to your 
 investigation, such as packets sent from a specific IP address.

 P-cap files can come in many formats depending on the packet capture library that’s used. Each format has different uses and 
 network tools may use or support specific packet capture file formats by default. You should be familiar with the following 
 libraries and formats:

 1.Libpcap is a packet capture library designed to be used by Unix-like systems, like Linux and MacOS®. Tools like tcpdump use 
   Libpcap as the default packet capture file format. 

 2.WinPcap is an open-source packet capture library designed for devices running Windows operating systems. It’s considered an 
   older file format and isn’t predominantly used.

 3.Npcap is a library designed by the port scanning tool Nmap that is commonly used in Windows operating systems.

 4.PCAPng is a modern file format that can simultaneously capture packets and store data. Its ability to do both explains the “ng,” 
   which stands for “next generation.”

Internet Protocol (IP):
Packets form the foundation of data exchange over a network, which means that detection begins at the packet level. The Internet 
Protocol (IP) includes a set of standards used for routing and addressing data packets as they travel between devices on a network. 
IP operates as the foundation for all communications over the internet. IP ensures that packets reach their destinations. There are 
two versions of IP that you will find in use today: IPv4 and IPv6. Both versions use different headers to structure packet information. 

 IPv4:
 IPv4 is the most commonly used version of IP. There are thirteen fields in the header:

 ->Version: This field indicates the IP version. For an IPv4 header, IPv4 is used. 

 ->Internet Header Length (IHL): This field specifies the length of the IPv4 header including any Options.

 ->Type of Service (ToS): This field provides information about packet priority for delivery.

 ->Total Length: This field specifies the total length of the entire IP packet including the header and the data.

 ->Identification: Packets that are too large to send are fragmented into smaller pieces. This field specifies a unique identifier 
   for fragments of an original IP packet so that they can be reassembled once they reach their destination.

 ->Flags: This field provides information about packet fragmentation including whether the original packet has been fragmented and 
   if there are more fragments in transit.

 ->Fragment Offset: This field is used to identify the correct sequence of fragments.

 ->Time to Live (TTL): This field limits how long a packet can be circulated in a network, preventing packets from being forwarded 
   by routers indefinitely.

 ->Protocol: This field specifies the protocol used for the data portion of the packet.

 ->Header Checksum: This field specifies a checksum value which is used for error-checking the header.

 ->Source Address: This field specifies the source address of the sender.

 ->Destination Address: This field specifies the destination address of the receiver.

 ->Options: This field is optional and can be used to apply security options to a packet.

 IPv6:
 IPv6 adoption has been increasing because of its large address space. There are eight fields in the header:

 ->Version: This field indicates the IP version. For an IPv6 header, IPv6 is used.

 ->Traffic Class: This field is similar to the IPv4 Type of Service field. The Traffic Class field provides information about the 
   packet's priority or class to help with packet delivery.

 ->Flow Label: This field identifies the packets of a flow. A flow is the sequence of packets sent from a specific source. 

 ->Payload Length: This field specifies the length of the data portion of the packet.

 ->Next Header: This field indicates the type of header that follows the IPv6 header such as TCP.

 ->Hop Limit: This field is similar to the IPv4 Time to Live field. The Hop Limit limits how long a packet can travel in a network 
   before being discarded.

 ->Source Address: This field specifies the source address of the sender.

 ->Destination Address: This field specifies the destination address of the receiver.

 Header fields contain valuable information for investigations and tools like Wireshark help to display these fields in a 
 human-readable format.

Wireshark:
Wireshark is an open-source network protocol analyzer. It uses a graphical user interface (GUI), which makes it easier to visualize 
network communications for packet analysis purposes.

 Display filters:
 Wireshark's display filters let you apply filters to packet capture files. This is helpful when you are inspecting packet captures 
 with large volumes of information. Display filters will help you find specific information that's most relevant to your investigation. 
 You can filter packets based on information such as protocols, IP addresses, ports, and virtually any other property found in a 
 packet.

 Comparison operators:
 You can use different comparison operators to locate specific header fields and values. Comparison operators can be expressed using 
 either abbreviations or symbols. For example, this filter using the == equal symbol in this filter ip.src == 8.8.8.8 is identical 
 to using the eq abbreviation in this filter ip.src eq 8.8.8.8.

  ->Equal: == , eq

  ->Not equal: != , ne

  ->Greater than: > , gt

  ->Less than: < , lt

  ->Greater than or equal to: >= , ge

  ->Less than or equal to: <= , le

 Pro tip: You can combine comparison operators with Boolean logical operators like and and or to create complex display filters.
 Parentheses can also be used to group expressions and to prioritize search terms.

 Contains operator:
 The contains operator is used to filter packets that contain an exact match of a string of text.

 Matches operator:
 The matches operator is used to filter packets based on the regular expression (regex) that's specified. Regular expression is a 
 sequence of characters that forms a pattern.

 Filter toolbar:
 You can apply filters to a packet capture using Wireshark's filter toolbar.

 Pro tip: Wireshark uses different colors to represent protocols. You can customize colors and create your own filters.

  Filter for protocols:
  Protocol filtering is one of the simplest ways you can use display filters. You can simply enter the name of the protocol to 
  filter. For example, to filter for DNS packets simply type dns in the filter toolbar. Here is a list of some protocols you can 
  filter for:

  ->dns

  ->http

  ->ftp

  ->ssh

  ->arp

  ->telnet

  ->icmp

  Filter for an IP address:
  You can use display filters to locate packets with a specific IP address. 

  For example, if you would like to filter packets that contain a specific IP address use ip.addr, followed by a space, the 
  equal == comparison operator, and the IP address. Here is an example of a display filter that filters for the IP address 
  172.21.224.2:

  ip.addr == 172.21.224.2

  To filter for packets originating from a specific source IP address, you can use the ip.src filter. Here is an example that looks 
  for the 10.10.10.10 source IP address:

  ip.src == 10.10.10.10

  To filter for packets delivered to a specific destination IP address, you can use the ip.dst filter. Here is an example that 
  searches for the 4.4.4.4 destination IP address:

  ip.dst == 4.4.4.4

  Filter for a MAC address
  You can also filter packets according to the Media Access Control (MAC) address.

  Here's an example:
  eth.addr == 00:70:f4:23:18:c4

  Filter for ports
  Port filtering is used to filter packets based on port numbers. This is helpful when you want to isolate specific types of traffic. 
  DNS traffic uses TCP or UDP port 53 so this will list traffic related to DNS queries and responses only.

  For example, if you would like to filter for a UDP port:
  udp.port == 53

  Likewise, you can filter for TCP ports as well:
  tcp.port == 25

 Follow streams:
 Wireshark provides a feature that lets you filter for packets specific to a protocol and view streams. A stream or conversation is 
 the exchange of data between devices using a protocol. Wireshark reassembles the data that was transferred in the stream in a way 
 that's simple to read. Following a protocol stream is useful when trying to understand the details of a conversation. For example, 
 you can examine the details of an HTTP conversation to view the content of the exchanged request and response messages.

Tcpdump:
Tcpdump is a command-line network protocol analyzer. Tcpdump is used to capture network traffic. This traffic can be saved to a 
packet capture (p-cap), which is a file containing data packets intercepted from an interface or network. The p-cap file can be  
accessed, analyzed, or shared at a later time. Analysts use tcpdump for a variety of reasons, from troubleshooting network issues 
to identifying malicious activity. Tcpdump comes pre-installed in many Linux distributions and can also be installed on other 
Unix-based operating systems such as macOS®. 

Note: It's common for network traffic to be encrypted, which means data is encoded and unreadable. Inspecting the network packets 
might require decrypting the data using the appropriate private keys.

 Capturing packets with tcpdump
 Like many other packet sniffing tools, you’ll need to have administrator-level privileges to capture network traffic using tcpdump. 
 This means you will need to either be logged in as the root user or have the ability to use the sudo command. Here is a breakdown 
 of the tcpdump syntax for capturing packets:

 sudo tcpdump [-i interface] [option(s)] [expression(s)]

 ->The sudo tcpdump command begins running tcpdump using elevated permissions as sudo. 

 ->The -i parameter specifies the network interface to capture network traffic. You must specify a network interface to capture from 
   to begin capturing packets. For example, if you specify -i any you’ll sniff traffic from all network interfaces on the system. 

 ->The option(s) are optional and provide you with the ability to alter the execution of the command. The expression(s) are a way 
   to further filter network traffic packets so that you can isolate network traffic. 

 Note: Before you can begin capturing network traffic, you must identify which network interface you'll want to use to capture 
 packets from. You can use the -D flag to list the network interfaces available on a system.

 Options:
 With tcpdump, you can apply options, also known as flags, to the end of commands to filter network traffic. Short options are 
 abbreviated and represented by a hyphen and a single character like -i. Long options are spelled out using a double hyphen like 
 --interface.

 Note: tcpdump options that are written using short options can be written with or without a space between the option and its value. 
 For example, sudo tcpdump -i any -c 3 and sudo tcpdump -iany -c3 are equivalent commands.

  -w:
  Using the -w flag, you can write or save the sniffed network packets to a packet capture file instead of just printing it out in 
  the terminal. This is very useful because you can refer to this saved file for later analysis. In this command, tcpdump is 
  capturing network traffic from all network interfaces and saving it to a packet capture file named packetcapture.pcap:

  sudo tcpdump -i any -w packetcapture.pcap

  -r:
  Using the -r flag, you can read a packet capture file by specifying the file name as a parameter. Here is an example of a tcpdump 
  command that reads a file called packetcapture.pcap:

  sudo tcpdump -r packetcapture.pcap

  -v:
  As you’ve learned, packets contain a lot of information. By default, tcpdump will not print out all of a packet's information. 
  This option, which stands for verbose, lets you control how much packet information you want tcpdump to print out.

  There are three levels of verbosity you can use depending on how much packet information you want tcpdump to print out. The levels 
  are -v, -vv, and -vvv. The level of verbosity increases with each added v. The verbose option can be helpful if you’re looking 
  for packet information like the details of a packet’s IP header fields. Here’s an example of a tcpdump command that reads the 
  packetcapture.pcap file with verbosity:

  sudo tcpdump -r packetcapture.pcap -v

  -c:
  The -c option stands for count. This option lets you control how many packets tcpdump will capture. For example, specifying -c 1 
  will only print out one single packet, whereas -c 10 prints out 10 packets. This example is telling tcpdump to only capture the 
  first three packets it sniffs from any network interface:

  sudo tcpdump -i any -c 3

  -n:
  By default, tcpdump will perform name resolution. This means that tcpdump automatically converts IP addresses to names. It will 
  also resolve ports to commonly associated services that use these ports. This can be problematic because tcpdump isn’t always 
  accurate in name resolution. For example, tcpdump can capture traffic from port 80 and automatically translates port 80 to HTTP 
  in the output. However, this is misleading because port 80 isn’t always going to be using HTTP; it could be using a different 
  protocol.

  Additionally, name resolution uses what’s known as a reverse DNS lookup. A reverse DNS lookup is a query that looks for the domain 
  name associated with an IP address. If you perform a reverse DNS lookup on an attacker’s system, they might be alerted that you 
  are investigating them through their DNS records.

  Using the -n flag disables this automatic mapping of numbers to names and is considered to be best practice when sniffing or 
  analyzing traffic. Using -n will not resolve hostnames, whereas -nn will not resolve both hostnames or ports. Here’s an example 
  of a tcpdump command that reads the packetcapture.pcap file with verbosity and disables name resolution:

  sudo tcpdump -r packetcapture.pcap -v -n
  
  Pro tip: You can combine options together. For example, -v and -n can be combined as -vn. But, if an option accepts a parameter 
  right after it like -c 1 or -r capture.pcap then you can’t combine other options to it.

 Expressions:
 Using filter expressions in tcpdump commands is also optional, but knowing how and when to use filter expressions can be helpful 
 during packet analysis. There are many ways to use filter expressions. 

 If you want to specifically search for network traffic by protocol, you can use filter expressions to isolate network packets. 
 For example, you can filter to find only IPv6 traffic using the filter expression ip6.

 You can also use boolean operators like and, or, or not to further filter network traffic for specific IP addresses, ports, and 
 more. The example below reads the packetcapture.pcap file and combines two expressions ip and port 80 using the and boolean 
 operator:

 sudo tcpdump -r packetcapture.pcap -n 'ip and port 80'

 Pro tip: You can use single or double quotes to ensure that tcpdump executes all of the expressions. You can also use parentheses 
 to group and prioritize different expressions. Grouping expressions is helpful for complex or lengthy commands. For example, the 
 command ip and (port 80 or port 443) tells tcpdump to prioritize executing the filters enclosed in the parentheses before filtering 
 for IPv4.

 Interpreting output:
 Once you run a command to capture packets, tcpdump will print the output of the command as the sniffed packets. In the output, 
 tcpdump prints one line of text for each packet with each line beginning with a timestamp. Here’s an example of a command and 
 output for a single TCP packet: 

 sudo tcpdump -i any -v -c 1

 1.Timestamp: The output begins with the timestamp, which starts with hours, minutes, seconds, and fractions of a second. 

 2.Source IP: The packet’s origin is provided by its source IP address.

 3.Source port: This port number is where the packet originated.

 4.Destination IP: The destination IP address is where the packet is being transmitted to.

 5.Destination port: This port number is where the packet is being transmitted to.

Detection:
Detection refers to the prompt discovery of security events.

 Methods of detection:
 
 Threat Hunter: Threat hunting is the proactive search for threats on a network. Security professionals use threat hunting to 
 uncover malicious activity that was not identified by detection tools and as a way to do further analysis on detections. Threat 
 hunting is also used to detect threats before they cause damage. For example, fileless malware is difficult for detection tools to 
 identify. It’s a form of malware that uses sophisticated evasion techniques such as hiding in memory instead of using files or 
 applications, allowing it to bypass traditional methods of detection like signature analysis. With threat hunting, the combination 
 of active human analysis and technology is used to identify threats like fileless malware. 

 Threat intelligence:
 Organizations can improve their detection capabilities by staying updated on the evolving threat landscape and understanding the 
 relationship between their environment and malicious actors. One way to understand threats is by using threat intelligence, which 
 is evidence-based threat information that provides context about existing or emerging threats. 

 Threat intelligence can come from private or public sources like:

 ->Industry reports: These often include details about attacker's tactics, techniques, and procedures (TTP).

 ->Government advisories: Similar to industry reports, government advisories include details about attackers' TTP. 

 ->Threat data feeds: Threat data feeds provide a stream of threat-related data that can be used to help protect against 
   sophisticated attackers like advanced persistent threats (APTs). APTs are instances when a threat actor maintains unauthorized 
   access to a system for an extended period of time. The data is usually a list of indicators like IP addresses, domains, and file 
   hashes.

 It can be difficult for organizations to efficiently manage large volumes of threat intelligence. Organizations can leverage a 
 threat intelligence platform (TIP) which is an application that collects, centralizes, and analyzes threat intelligence from 
 different sources. TIPs provide a centralized platform for organizations to identify and prioritize relevant threats and improve 
 their security posture. 

 Note: Threat intelligence data feeds are best used to add context to detections. They should not drive detections completely and 
 should be assessed before applied to an organization.

 Cyber deception:
 Cyber deception involves techniques that deliberately deceive malicious actors with the goal of increasing detection and improving 
 defensive strategies. Honeypots are an example of an active cyber defense mechanism that uses deception technology. Honeypots are 
 systems or resources that are created as decoys vulnerable to attacks with the purpose of attracting potential intruders. For 
 example, having a fake file labeled Client Credit Card Information - 2022 can be used to capture the activity of malicious actors 
 by tricking them into accessing the file because it appears to be legitimate. Once a malicious actor tries to access this file, 
 security teams are alerted.